<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <!-- 引入element-ui樣式 -->
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <link rel="stylesheet" type="text/css" href="style.css">
</head>

<body>
    <div id="app">
        <el-container class="content">
            <el-aside class="aside">
                <br />
                <el-row :gutter="10" type="flex">
                    <el-col :span="10">
                        <el-button type="primary" @click="GetData">獲取資料</el-button>
                    </el-col>
                    <el-col :span="10">
                        <el-button type="primary" @click="showData">顯示資料</el-button>
                    </el-col>
                    <el-col :span="10">
                        <el-button type="primary" @click="ShowDiaLog">彈出視窗</el-button>
                    </el-col>
                </el-row>
                <br />
            </el-aside>

            <el-main class="main">
                <!-- 呼叫menu組件 -->
                <menu-container v-bind="searchValue" @update="updateInfo"></menu-container>
                <!-- x-template寫法，包覆組件內html -->
                <script type="text/x-template" id="menuComponent">
                    <div>
                        <label>請輸入id</label>
                        <el-input size="mini" type="text" v-on:keyup.enter.native=" IdSearch" v-model="searchValue.Id"></el-input>
                        <br />
                        <label>你搜尋的id是:{{searchValue.Id}}</label>
                        <br />
                        <label>請輸入title</label>
                        <!-- <el-input size="mini" type="text" @keyup.enter.native="TitleSearch" v-model="title"></el-input> -->
                        <el-input size="mini" type="text"v-model="searchValue.Title"></el-input>
                        <br />
                        <label>你搜尋的標題是:{{searchValue.Title}}</label>
                        <br />
                        <label>請輸入userId</label>
                        <!-- <el-input size="mini" type="text" @keyup.enter.native="TitleSearch" v-model="title"></el-input> -->
                        <el-input size="mini" type="text"v-model="searchValue.Userid"></el-input>
                        <br />
                        <label>你搜尋的標題是:{{searchValue.Userid}}</label>
                        <br />

                        <label>取得特定一筆的資料</label>
                        <el-input size="mini" type="number" v-model="dataCount"></el-input>
                        <br />
                        <el-button type="primary" @click="SingleGetData">取得第{{dataCount}}筆的資料</el-button>
                        <br />
                        
                        <label>查詢UserId的資料</label>
                        <el-select size="mini" type="number" v-model="UserId" clearable placeholder="選擇userId">
                            <el-option v-for="index in 10" :value="index">
                            </el-option>
                        </el-select>
                        <br />
                        <el-button type="primary" @click="SingleGetUserId">查詢UserID</el-button>
                        <br />
                    </div>
                </script>


            </el-main>
            <el-main class="botton">
                修改新增
                <br />
                <label>Userid輸入</label>
                <el-input size="mini" maxlength="5" v-model="modifyValue.UserId"></el-input>
                <br />
                <label>你輸入的Userid是:{{modifyValue.UserId}}</label>
                <br />
                <label>id輸入</label>
                <el-input size="mini" maxlength="5" v-model="modifyValue.Id"></el-input>
                <br />
                <label>你輸入的id是:{{modifyValue.Id}}</label>
                <br />
                <label>title輸入</label>
                <el-input size="mini" v-model="modifyValue.Title"></el-input>
                <br />
                <label>你輸入的title是:{{modifyValue.Title}}</label>
                <br />
                <label>body輸入</label>
                <el-input size="mini" v-model="modifyValue.Body"></el-input>
                <br />
                <label>你輸入的body是:{{modifyValue.Body}}</label>
                <br />
                <el-button type="primary" @click="AddData">新增資料</el-button>
                <el-button type="primary" @click="DeleteSingleData">刪除特定資料</el-button>
            </el-main>
        </el-container>
        <section v-show="showdata">
            <!-- 輸出資料區 -->
            <div v-bind="outputData" v-for="(item,index) in outputData">
                {
                <br />
                "userId":{{item.userId}},
                <br />
                "id":{{item.id}},
                <br />
                "title":{{item.title}},
                <br />
                "body":{{item.body}},
                <br />
                },
                <br />
                <el-button type="primary" @click="DeleteData(item.id)">刪除資料</el-button>
                <br />
            </div>
        </section>

        <!-- 跳出視窗 -->
        <el-dialog title="Menu" :visible.sync="dialogVisible" @close="" class="MenuDialog">
            <!-- 呼叫menu組件 -->
            <menu-container></menu-container>

            <el-button @click="dialogVisible = false">關閉</el-button>
        </el-dialog>

    </div>
</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.7.13/vue.js"
    integrity="sha512-DVdnL1SgeU//B2dtynn5ZdVMkjW/i/cCZRgkaAAl1sQVNVqtMi54Fr6o2tFo7M+3GWGX6VLLhNRRg9oKlMSGBw=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<!-- 引入element-ui组件庫 -->
<script src="https://unpkg.com/element-ui/lib/index.js"></script>
<script>

    // func包裹住程式，當與其他人的程式並接時候就不會有命名衝突或是區塊衝突等問題
    ; (function () {
        // HttpHeader設定檔(傳送內容以外的資訊)
        const headers = {
            'Content-Type': 'application/json;',
        };
        const app = new Vue({
            el: '#app',
            data: {
                showdata: false,
                outputData: [],
                searchValue: {
                    id: null,
                    title: null,
                    userid: null,
                },
                dataCount: 0,
                DataLength: 0,
                modifyValue: {
                    UserId: null,
                    Id: null,
                    Title: null,
                    Body: null,
                },
                dialogVisible: false,
                dialogcontain: null,
            },
            methods: {
                GetData() {
                    axios.get('http://localhost:5293/MyApps')
                        .then((res) => {
                            this.outputData = res.data;
                            DataLength = this.outputData.length;
                            //暫存資料
                            console.log("資料獲取成功");
                        })
                        .catch((error) => { console.error(error) })
                },
                // 顯示資料
                showData() {
                    this.showdata = !(this.showdata);
                    console.log(this.id);
                },
                AllSearch() {
                    console.log(this.searchValue);
                    if (isNaN(this.id)) {
                        alert(`請輸入數字`);
                    } else if (this.id >= this.templateData.length && this.id > 0) {
                        alert(`搜尋值找不到，請重新輸入`);
                    }
                    else if (this.id == null || this.title == null) {
                        // 可改善點
                        if (this.id == null && this.title != null) {
                            // 標題搜尋
                        } else if (this.id != null && this.title == null) {
                            // id搜尋
                        }
                    }
                    else {
                        this.searchValue.id = parseInt(this.id);
                        this.searchValue.title = this.title;
                    }

                    axios.post('http://localhost:5293/MyApps/AllSearch',
                        this.searchValue, { headers: headers })
                        // axios請求提交數據,(位址，資料，表頭)
                        .then((response) => {
                            // 回傳的值在這裡
                            console.log(response.data);
                            this.outputData = response.data
                        })
                        .catch((error) => {
                            console.log(`Allsearch錯誤${this.searchValue}`);
                            console.log(error);
                        })
                    this.id = null;
                    this.title = null;
                },
                AddData() {
                    console.log(this.modifyValue);
                    // 新增資料
                    if (this.modifyValue == null) {
                        return null;
                    }
                    else {
                        axios.put('http://localhost:5293/MyApps/AddData',
                            this.modifyValue, { headers: headers })
                            .then((response) => {
                                console.log(`推送資料成功`);
                                console.log(response);
                                this.outputData = [];
                                this.outputData = response.data;
                                DataLength = this.outputData.length;
                            })
                            .catch((error) => {
                                console.log(`推送資料失敗`);
                                console.log(error);
                            })
                    }
                    // 清空輸入值
                    this.modifyValue = {};
                },
                DeleteData(id) {
                    // 單筆資料刪除
                    console.log(id);
                    axios.delete(`http://localhost:5293/MyApps/DeletData/${id}`)
                        .then((response) => {
                            console.log(`刪除資料成功`);
                            console.log(response);
                            this.outputData = [];
                            // 更新前端資料畫面
                            this.outputData = response.data;
                            DataLength = this.outputData.length;
                        })
                        .catch((error) => {
                            console.log(`刪除資料失敗`);
                            console.log(error);
                        })
                    this.modifyValue = {};
                },

                DeleteSingleData() {
                    // 特定資料刪除
                    if (this.modifyValue.Id == null && this.modifyValue.Title == null
                        && this.modifyValue.UserId == null && this.modifyValue.Body == null) {
                        alert("輸入值為空");
                    }
                    else {
                        axios.delete(`http://localhost:5293/MyApps/DeleteSingleData`,
                            { data: this.modifyValue }, { headers: headers })
                            .then((response) => {
                                console.log(`資料刪除成功`);
                                console.log(response);
                                // 更新前端資料畫面
                                this.outputData = [];
                                this.outputData = response.data;
                            })
                            .catch((error) => {
                                console.log(`資料刪除失敗`);
                                console.log(error);
                            })
                    }
                    this.modifyValue = {};
                },
                ShowDiaLog() {
                    this.dialogVisible = true;
                },
                updateInfo(){

                },
            },
            components: {
                'menu-container': {
                    template: `#menuComponent`,
                    props: ['id', 'title', 'userid',],
                    data: () => {
                        return {
                            searchValue: {
                                Id: this.id,
                                Title: this.title,
                                Userid: this.userid,
                            },
                            dataCount: 0,
                            UserId: 0,
                            outputdata: [],
                        }
                    },
                    methods: {
                        IdSearch() {
                            if (isNaN(this.searchValue.Id)) {
                                alert(`請輸入數字`);
                            }
                            else {
                                // 將id的資料型別轉數字
                                this.searchValue.Id = parseInt(this.searchValue.Id);
                                console.log(this.searchValue.Id);
                                axios.get(`http://localhost:5293/MyApps/IdSearch/${this.searchValue.Id}`,
                                    { headers: headers })
                                    // axios請求提交數據,(位址，資料，表頭)
                                    .then((response) => {
                                        // 回傳的值在這裡
                                        console.log(`搜尋成功`);
                                        console.log(response.data);
                                        this.outputData = [];
                                        this.outputData.push(response.data);
                                    })
                                    .catch((error) => {
                                        console.log(`搜尋失敗`);
                                    })
                            }
                            // 清空輸入值
                            this.searchValue.Id = null;
                        },
                        SingleGetData() {
                            // 用GET的方式單獨查詢一筆資料
                            if (this.dataCount < 0) {
                            }
                            else {
                                axios.get(`http://localhost:5293/MyApps/?id=${this.dataCount}`)
                                    .then((response) => {
                                        console.log(response.data);
                                        this.outputData = [];
                                        this.outputData = response.data;
                                    })
                                    .catch((error) => {
                                        console.log(`取得資料失敗`);
                                        console.log(error);
                                    })
                            }
                            this.dataCount = 0;
                        },
                        SingleGetUserId() {
                            // 查詢userid
                            console.log(this.UserId);
                            axios.get(`http://localhost:5293/MyApps/${this.UserId}`)
                                // 差別點
                                .then((response) => {
                                    console.log(response.data);
                                    this.outputData = [];
                                    this.outputData = response.data;
                                })
                                .catch((error) => {
                                    console.log(`取得資料失敗`);
                                    console.log(error);
                                })
                            this.UserId = 0;
                        },
                    },
                    watch:{
                        //watch 可傳入參數，第一個參數是更新後的值，第二是舊值。 
                        searchValue: {
                            deep:true,
                            
                        },
                    },
                }
            },
        })
    })()


</script>
</body>

</html>